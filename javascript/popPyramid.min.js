function pyramidBuilder(H,G,g){var s=typeof g.width==="undefined"?400:g.width,C=typeof g.height==="undefined"?400:g.height,x=s,A=C;if(s>$(window).width()){s=$(window).width()}var v={top:50,right:10,bottom:20,left:10,middle:20},c=(s/2)-v.middle,j=c-v.left,k=s-v.right-c;s=(s-(v.left+v.right));C=(C-(v.top+v.bottom));if(typeof g.style==="undefined"){var D={leftBarColor:"#6c9dc6",rightBarColor:"#de5454",tooltipBG:"#fefefe",tooltipColor:"black"}}else{var D={leftBarColor:typeof g.style.leftBarColor==="undefined"?"#6c9dc6":g.style.leftBarColor,rightBarColor:typeof g.style.rightBarColor==="undefined"?"#de5454":g.style.rightBarColor,tooltipBG:typeof g.style.tooltipBG==="undefined"?"#fefefe":g.style.tooltipBG,tooltipColor:typeof g.style.tooltipColor==="undefined"?"black":g.style.tooltipColor}}var q=d3.sum(H,function(h){return h.male+h.female}),u=function(h){return h/q};var y=d3.select(G).append("style").text("svg {max-width:100%}     .axis line,axis path {shape-rendering: crispEdges;fill: transparent;stroke: #555;}     .axis text {font-size: 11px;}     .bar {fill-opacity: 0.5;}     .bar.left {fill: "+D.leftBarColor+";}     .bar.left:hover {fill: "+F(D.leftBarColor,"333333")+";}     .bar.right {fill: "+D.rightBarColor+";}     .bar.right:hover {fill: "+F(D.rightBarColor,"333333")+";}     .tooltip {position: absolute;line-height: 1.1em;padding: 7px; margin: 3px;background: "+D.tooltipBG+"; color: "+D.tooltipColor+"; pointer-events: none;border-radius: 6px;}");var i=d3.select(G).append("svg").attr("width",x).attr("height",A);var a=i.append("g").attr("class","legend");a.append("rect").attr("class","bar left").attr("x",(s/2)-(v.middle*3)).attr("y",12).attr("width",12).attr("height",12);a.append("text").attr("fill","#000").attr("x",(s/2)-(v.middle*2)).attr("y",18).attr("dy","0.32em").text("Males");a.append("rect").attr("class","bar right").attr("x",(s/2)+(v.middle*2)).attr("y",12).attr("width",12).attr("height",12);a.append("text").attr("fill","#000").attr("x",(s/2)+(v.middle*3)).attr("y",18).attr("dy","0.32em").text("Females");var n=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);var p=i.append("g").attr("class","inner-region").attr("transform",o(v.left,v.top));var E=Math.ceil(Math.max(d3.max(H,function(h){return u(h.male)}),d3.max(H,function(h){return u(h.female)}))/0.05)*0.05;var I=d3.scaleLinear().domain([0,E]).range([0,(c-v.middle)]).nice();var d=d3.scaleLinear().domain([0,E]).range([c,0]);var r=d3.scaleLinear().domain([0,E]).range([0,c]);var b=d3.scaleBand().domain(H.map(function(h){return h.age})).range([C,0],0.1);var f=d3.axisRight().scale(b).tickSize(4,0).tickPadding(v.middle-4);var e=d3.axisLeft().scale(b).tickSize(4,0).tickFormat("");var B=d3.axisBottom().scale(I).tickFormat(d3.format(".0%"));var z=d3.axisBottom().scale(I.copy().range([j,0])).tickFormat(d3.format(".0%"));var m=p.append("g").attr("transform",o(j,0)+"scale(-1,1)");var l=p.append("g").attr("transform",o(k,0));p.append("g").attr("class","axis y left").attr("transform",o(j,0)).call(f).selectAll("text").style("text-anchor","middle");p.append("g").attr("class","axis y right").attr("transform",o(k,0)).call(e);p.append("g").attr("class","axis x left").attr("transform",o(0,C)).call(z);p.append("g").attr("class","axis x right").attr("transform",o(k,C)).call(B);m.selectAll(".bar.left").data(H).enter().append("rect").attr("class","bar left").attr("x",0).attr("y",function(h){return b(h.age)+v.middle/4}).attr("width",function(h){return I(u(h.male))}).attr("height",(b.range()[0]/H.length)-v.middle/2).on("mouseover",function(h){n.transition().duration(200).style("opacity",0.9);n.html("<strong>Males Age "+h.age+"</strong><br />  Population: "+t(h.male)+"<br />"+(Math.round(u(h.male)*1000)/10)+"% of Total").style("left",(d3.event.pageX)+"px").style("top",(d3.event.pageY-28)+"px")}).on("mouseout",function(h){n.transition().duration(500).style("opacity",0)});l.selectAll(".bar.right").data(H).enter().append("rect").attr("class","bar right").attr("x",0).attr("y",function(h){return b(h.age)+v.middle/4}).attr("width",function(h){return I(u(h.female))}).attr("height",(b.range()[0]/H.length)-v.middle/2).on("mouseover",function(h){n.transition().duration(200).style("opacity",0.9);n.html("<strong> Females Age "+h.age+"</strong><br />  Population: "+t(h.female)+"<br />"+(Math.round(u(h.female)*1000)/10)+"% of Total").style("left",(d3.event.pageX)+"px").style("top",(d3.event.pageY-28)+"px")}).on("mouseout",function(h){n.transition().duration(500).style("opacity",0)});function o(h,w){return"translate("+h+","+w+")"}function t(h){return h.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function F(J,w){var J=J.replace("#","");origHex={r:J.substring(0,2),g:J.substring(2,4),b:J.substring(4,6)},transVec={r:w.substring(0,2),g:w.substring(2,4),b:w.substring(4,6)},newHex={};function h(M,L){var K=parseInt(M,16)+parseInt(L,16);if(K>255){K=255}return K.toString(16)}newHex.r=h(origHex.r,transVec.r);newHex.g=h(origHex.g,transVec.g);newHex.b=h(origHex.b,transVec.b);return"#"+newHex.r+newHex.g+newHex.b}};

